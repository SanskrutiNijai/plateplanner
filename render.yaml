envGroups:
  - name: plateplanner-secrets
    vars:
      - key: SPRING_DATA_MONGODB_URI
        value: "<SET_IN_RENDER>"
      - key: SPRING_DATA_MONGODB_DATABASE
        value: "<SET_IN_RENDER>"
      - key: GEMINI_API_KEY
        value: "<SET_IN_RENDER>"
      - key: GEMINI_API_URL
        value: "<SET_IN_RENDER>"
      - key: SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_API_KEY_ID
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_API_KEY_SECRET
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_WEBHOOK_SECRET
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_BASE_URL
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_REALM
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_CLIENT_ID
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_CLIENT_SECRET
        value: "<SET_IN_RENDER>"

# --------------------------------------------------------------
# INTERNAL MICROSERVICES (web_service but internal-only)
# --------------------------------------------------------------

services:
  - type: web_service
    name: eurekaserver
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: eurekaserver
    plan: starter
    env: dockerless
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8761
    envVars:
      SPRING_APPLICATION_NAME: eurekaserver
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - eurekaserver/**

  - type: web_service
    name: userservice
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: userservice
    plan: starter
    env: dockerless
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8081
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: userservice
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - userservice/**

  - type: web_service
    name: recipeservice
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: recipeservice
    plan: starter
    env: dockerless
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8082
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: recipeservice
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - recipeservice/**

  - type: web_service
    name: aiservice
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: aiservice
    plan: starter
    env: dockerless
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8083
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: aiservice
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - aiservice/**

  - type: web_service
    name: paymentservice
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: paymentservice
    plan: starter
    env: dockerless
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8084
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: paymentservice
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - paymentservice/**

  - type: web_service
    name: recipeintelligenceservice
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: recipeintelligenceservice
    plan: starter
    env: dockerless
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8085
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: recipeintelligenceservice
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - recipeintelligenceservice/**

  # --------------------------------------------------------------
  # PUBLIC API GATEWAY (exposed)
  # --------------------------------------------------------------
  - type: web_service
    name: apigateway
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: apigateway
    plan: starter
    env: dockerless
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    # PUBLIC â†’ no internalPorts
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: apigateway
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - apigateway/**

# --------------------------------------------------------------
# PUBLIC FRONTEND (Vite React)
# --------------------------------------------------------------
staticSites:
  - name: frontend
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: frontend/plateplannerfrontend
    buildCommand: npm ci && npm run build
    publishPath: dist
    envVars: {}   # You will add VITE_ variables in dashboard
    autoDeploy: true
    includedPaths:
      - frontend/**
