# render.yaml - PlatePlanner Microservices Deployment (FINAL + VALID)

envGroups:
  - name: plateplanner-secrets
    vars:
      - key: SPRING_DATA_MONGODB_URI
        value: "<SET_IN_RENDER>"
      - key: SPRING_DATA_MONGODB_DATABASE
        value: "<SET_IN_RENDER>"
      - key: GEMINI_API_URL
        value: "<SET_IN_RENDER>"
      - key: GEMINI_API_KEY
        value: "<SET_IN_RENDER>"
      - key: SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_API_KEY_ID
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_API_KEY_SECRET
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_WEBHOOK_SECRET
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_BASE_URL
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_REALM
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_CLIENT_ID
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_CLIENT_SECRET
        value: "<SET_IN_RENDER>"

services:

  # -------------------------------------------------------------
  # EUREKA SERVER (INTERNAL)
  # -------------------------------------------------------------
  - name: eurekaserver
    type: web_service
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: eurekaserver
    branch: main
    plan: starter
    env: docker
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internal_port: 8761
    envVars:
      SPRING_APPLICATION_NAME: eurekaserver
    autoDeploy: true
    includedPaths:
      - eurekaserver/**

  # -------------------------------------------------------------
  # API GATEWAY (PUBLIC)
  # -------------------------------------------------------------
  - name: apigateway
    type: web_service
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: apigateway
    branch: main
    plan: starter
    env: docker
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    port: 8086
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: apigateway
    autoDeploy: true
    includedPaths:
      - apigateway/**

  # -------------------------------------------------------------
  # USERSERVICE (INTERNAL)
  # -------------------------------------------------------------
  - name: userservice
    type: web_service
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: userservice
    branch: main
    plan: starter
    env: docker
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internal_port: 8081
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: userservice
    autoDeploy: true
    includedPaths:
      - userservice/**

  # -------------------------------------------------------------
  # RECIPESERVICE (INTERNAL)
  # -------------------------------------------------------------
  - name: recipeservice
    type: web_service
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: recipeservice
    branch: main
    plan: starter
    env: docker
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internal_port: 8082
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: recipeservice
    autoDeploy: true
    includedPaths:
      - recipeservice/**

  # -------------------------------------------------------------
  # AISERVICE (INTERNAL)
  # -------------------------------------------------------------
  - name: aiservice
    type: web_service
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: aiservice
    branch: main
    plan: starter
    env: docker
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internal_port: 8083
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: aiservice
    autoDeploy: true
    includedPaths:
      - aiservice/**

  # -------------------------------------------------------------
  # PAYMENTSERVICE (INTERNAL)
  # -------------------------------------------------------------
  - name: paymentservice
    type: web_service
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: paymentservice
    branch: main
    plan: starter
    env: docker
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internal_port: 8084
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: paymentservice
    autoDeploy: true
    includedPaths:
      - paymentservice/**

  # -------------------------------------------------------------
  # RECIPE INTELLIGENCE SERVICE (INTERNAL)
  # -------------------------------------------------------------
  - name: recipeintelligenceservice
    type: web_service
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: recipeintelligenceservice
    branch: main
    plan: starter
    env: docker
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internal_port: 8085
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: recipeintelligenceservice
    autoDeploy: true
    includedPaths:
      - recipeintelligenceservice/**

# -------------------------------------------------------------
# FRONTEND STATIC SITE (PUBLIC)
# -------------------------------------------------------------
staticSites:
  - name: frontend
    type: static_site
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: frontend/plateplannerfrontend
    branch: main
    buildCommand: "npm ci && npm run build"
    publishPath: dist
    envVars: {}
    autoDeploy: true
    includedPaths:
      - frontend/**
