envGroups:
  - name: plateplanner-secrets
    vars:
      - key: SPRING_DATA_MONGODB_URI
        value: "<SET_IN_RENDER>"
      - key: SPRING_DATA_MONGODB_DATABASE
        value: "<SET_IN_RENDER>"
      - key: GEMINI_API_KEY
        value: "<SET_IN_RENDER>"
      - key: GEMINI_API_URL
        value: "<SET_IN_RENDER>"
      - key: SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_API_KEY_ID
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_API_KEY_SECRET
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_WEBHOOK_SECRET
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_BASE_URL
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_REALM
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_CLIENT_ID
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_CLIENT_SECRET
        value: "<SET_IN_RENDER>"

services:
  # -------------------------------------------------------------
  # 1) EUREKA SERVER  (internal only)
  # -------------------------------------------------------------
  - type: service
    name: eurekaserver
    env: dockerless
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: eurekaserver
    plan: starter
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8761
    envVars:
      SPRING_APPLICATION_NAME: eurekaserver
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - eurekaserver/**

  # -------------------------------------------------------------
  # 2) API GATEWAY (PUBLIC)
  # -------------------------------------------------------------
  - type: service
    name: apigateway
    env: dockerless
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: apigateway
    plan: starter
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: apigateway
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - apigateway/**
    # No internalPorts → service is PUBLIC

  # -------------------------------------------------------------
  # 3) USERSERVICE (internal)
  # -------------------------------------------------------------
  - type: service
    name: userservice
    env: dockerless
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: userservice
    plan: starter
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8081
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: userservice
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - userservice/**

  # -------------------------------------------------------------
  # 4) RECIPESERVICE (internal)
  # -------------------------------------------------------------
  - type: service
    name: recipeservice
    env: dockerless
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: recipeservice
    plan: starter
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8082
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: recipeservice
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - recipeservice/**

  # -------------------------------------------------------------
  # 5) AISERVICE (internal)
  # -------------------------------------------------------------
  - type: service
    name: aiservice
    env: dockerless
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: aiservice
    plan: starter
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8083
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: aiservice
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - aiservice/**

  # -------------------------------------------------------------
  # 6) PAYMENTSERVICE (internal)
  # -------------------------------------------------------------
  - type: service
    name: paymentservice
    env: dockerless
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: paymentservice
    plan: starter
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8084
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: paymentservice
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - paymentservice/**

  # -------------------------------------------------------------
  # 7) RECIPE INTELLIGENCE SERVICE (internal)
  # -------------------------------------------------------------
  - type: service
    name: recipeintelligenceservice
    env: dockerless
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: recipeintelligenceservice
    plan: starter
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    internalPorts:
      - 8085
    envVarGroups:
      - plateplanner-secrets
    envVars:
      SPRING_APPLICATION_NAME: recipeintelligenceservice
    healthCheckPath: /actuator/health
    autoDeploy: true
    includedPaths:
      - recipeintelligenceservice/**

# -------------------------------------------------------------
# 8) FRONTEND (Vite React App — public static site)
# -------------------------------------------------------------
staticSites:
  - name: frontend
    repo: https://github.com/SanskrutiNijai/plateplanner
    branch: main
    rootDir: frontend/plateplannerfrontend
    buildCommand: npm ci && npm run build
    publishPath: dist
    envVars: {}  # VITE_ variables added in Dashboard
    autoDeploy: true
    includedPaths:
      - frontend/**
