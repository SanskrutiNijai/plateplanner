previews:
  generation: automatic

envVarGroups:
  - name: plateplanner-secrets
    envVars:
      - key: SPRING_DATA_MONGODB_URI
        value: "<SET_IN_RENDER>"
      - key: SPRING_DATA_MONGODB_DATABASE
        value: "<SET_IN_RENDER>"
      - key: GEMINI_API_URL
        value: "<SET_IN_RENDER>"
      - key: GEMINI_API_KEY
        value: "<SET_IN_RENDER>"
      - key: SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_API_KEY_ID
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_API_KEY_SECRET
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_WEBHOOK_SECRET
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_BASE_URL
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_REALM
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_CLIENT_ID
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_CLIENT_SECRET
        value: "<SET_IN_RENDER>"

services:

  # -------------------------------------------------------------
  # EUREKA SERVER (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: eurekaserver
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: eurekaserver
    branch: main
    plan: starter
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internalPort: 8761
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: eurekaserver
    includedPaths:
      - eurekaserver/**

  # -------------------------------------------------------------
  # API GATEWAY (PUBLIC)
  # -------------------------------------------------------------
  - type: web
    name: apigateway
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: apigateway
    branch: main
    plan: starter
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    port: 8086
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: apigateway
    includedPaths:
      - apigateway/**

  # -------------------------------------------------------------
  # USERSERVICE (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: userservice
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: userservice
    branch: main
    plan: starter
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internalPort: 8081
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: userservice
    includedPaths:
      - userservice/**

  # -------------------------------------------------------------
  # RECIPESERVICE (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: recipeservice
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: recipeservice
    branch: main
    plan: starter
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internalPort: 8082
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: recipeservice
    includedPaths:
      - recipeservice/**

  # -------------------------------------------------------------
  # AISERVICE (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: aiservice
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: aiservice
    branch: main
    plan: starter
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internalPort: 8083
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: aiservice
    includedPaths:
      - aiservice/**

  # -------------------------------------------------------------
  # PAYMENTSERVICE (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: paymentservice
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: paymentservice
    branch: main
    plan: starter
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internalPort: 8084
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: paymentservice
    includedPaths:
      - paymentservice/**

  # -------------------------------------------------------------
  # RECIPE INTELLIGENCE SERVICE (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: recipeintelligenceservice
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: recipeintelligenceservice
    branch: main
    plan: starter
    buildCommand: "./mvnw -DskipTests package"
    startCommand: "java -jar target/*.jar"
    internalPort: 8085
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: recipeintelligenceservice
    includedPaths:
      - recipeintelligenceservice/**

  # -------------------------------------------------------------
  # FRONTEND STATIC SITE (PUBLIC)
  # -------------------------------------------------------------
  - type: web
    name: frontend
    runtime: static
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: frontend/plateplannerfrontend
    branch: main
    buildCommand: "npm ci && npm run build"
    staticPublishPath: dist
    includedPaths:
      - frontend/**
