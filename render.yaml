previews:
  generation: automatic

envVarGroups:
  - name: plateplanner-secrets
    envVars:
      - key: SPRING_DATA_MONGODB_URI
        value: "<SET_IN_RENDER>"
      - key: SPRING_DATA_MONGODB_DATABASE
        value: "<SET_IN_RENDER>"
      - key: GEMINI_API_URL
        value: "<SET_IN_RENDER>"
      - key: GEMINI_API_KEY
        value: "<SET_IN_RENDER>"
      - key: SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_API_KEY_ID
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_API_KEY_SECRET
        value: "<SET_IN_RENDER>"
      - key: RAZORPAY_WEBHOOK_SECRET
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_BASE_URL
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_REALM
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_CLIENT_ID
        value: "<SET_IN_RENDER>"
      - key: KEYCLOAK_CLIENT_SECRET
        value: "<SET_IN_RENDER>"

services:
  # -------------------------------------------------------------
  # EUREKA SERVER (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: eurekaserver
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: eurekaserver
    branch: main
    plan: starter
    private: true
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    port: 8761
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: eurekaserver
      - key: PORT
        value: "8761"

  # -------------------------------------------------------------
  # API GATEWAY (PUBLIC SERVICE)
  # -------------------------------------------------------------
  - type: web
    name: apigateway
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: apigateway
    branch: main
    plan: starter
    private: false
    port: 8086
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: apigateway
      - key: PORT
        value: "8086"

  # -------------------------------------------------------------
  # USERSERVICE (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: userservice
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: userservice
    branch: main
    plan: starter
    private: true
    port: 8081
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: userservice
      - key: PORT
        value: "8081"

  # -------------------------------------------------------------
  # RECIPESERVICE (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: recipeservice
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: recipeservice
    branch: main
    plan: starter
    private: true
    port: 8082
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: recipeservice
      - key: PORT
        value: "8082"

  # -------------------------------------------------------------
  # AISERVICE (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: aiservice
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: aiservice
    branch: main
    plan: starter
    private: true
    port: 8083
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: aiservice
      - key: PORT
        value: "8083"

  # -------------------------------------------------------------
  # PAYMENTSERVICE (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: paymentservice
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: paymentservice
    branch: main
    plan: starter
    private: true
    port: 8084
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: paymentservice
      - key: PORT
        value: "8084"

  # -------------------------------------------------------------
  # RECIPE INTELLIGENCE SERVICE (INTERNAL)
  # -------------------------------------------------------------
  - type: web
    name: recipeintelligenceservice
    runtime: docker
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: recipeintelligenceservice
    branch: main
    plan: starter
    private: true
    port: 8085
    buildCommand: ./mvnw -DskipTests package
    startCommand: java -jar target/*.jar
    envVarGroups:
      - plateplanner-secrets
    envVars:
      - key: SPRING_APPLICATION_NAME
        value: recipeintelligenceservice
      - key: PORT
        value: "8085"

  # -------------------------------------------------------------
  # FRONTEND STATIC SITE (PUBLIC)
  # -------------------------------------------------------------
  - type: web
    name: frontend
    runtime: static
    repo: https://github.com/SanskrutiNijai/plateplanner
    rootDir: frontend/plateplannerfrontend
    branch: main
    buildCommand: npm ci && npm run build
    staticPublishPath: dist
    envVars: {}
